name: Discord Workflow Notifier

on:
  workflow_run:
    workflows: ["Auto Assign Issues", "Auto Assign Prs", "CI & Docker Publish", "Proof HTML"] 
    types:
      - requested
      - completed

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send workflow status to Discord
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          NAME="${{ github.event.workflow_run.name }}"
          STATUS="${{ github.event.workflow_run.status }}"
          CONCLUSION="${{ github.event.workflow_run.conclusion }}"
          URL="${{ github.event.workflow_run.html_url }}"

          if [[ "$STATUS" == "requested" ]]; then
            MSG="ðŸš€ Deployment started"
          elif [[ "$CONCLUSION" == "success" ]]; then
            MSG="âœ… Deployment succeeded"
          else
            MSG="ðŸ”¥ Deployment failed"
          fi

          curl -H "Content-Type: application/json" \
          -X POST \
          -d "{
            \"content\": \"$MSG\",
            \"embeds\": [{
              \"title\": \"$NAME\",
              \"url\": \"$URL\"
            }]
          }" \
          $DISCORD_WEBHOOK_URL

